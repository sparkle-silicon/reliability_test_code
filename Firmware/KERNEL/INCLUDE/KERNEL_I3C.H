/*
 * @Author: Iversu
 * @LastEditors: daweslinyu daowes.ly@qq.com
 * @LastEditTime: 2025-07-07 11:14:56
 * @Description:
 *
 *
 * The following is the Chinese and English copyright notice, encoded as UTF-8.
 * 以下是中文及英文版权同步声明，编码为UTF-8。
 * Copyright has legal effects and violations will be prosecuted.
 * 版权具有法律效力，违反必究。
 *
 * Copyright ©2021-2023 Sparkle Silicon Technology Corp., Ltd. All Rights Reserved.
 * 版权所有 ©2021-2023龙晶石半导体科技（苏州）有限公司
 */

#ifndef __KERNEL_I3C_H
#define __KERNEL_I3C_H
#include "AE_GLOBAL.H"
#include "AE_REG.H"
#include "AE_CONFIG.H"
#include "AE_DEBUGGER.H"

#define I3C_MASTER0 0
#define I3C_MASTER1 1
#define I3C_SLAVE0 2
#define I3C_SLAVE1 3

 //以下内容只是寄存器位的部分情况，详细内容请阅读I3C的寄存器手册  
#define I3C_MASTER_DEVICE_CTRL_IBA_INCLUDE 0x00000001UL
#define I3C_MASTER_DEVICE_CTRL_I2C_SLAVE_PRESENT 0x00000080UL
#define I3C_MASTER_DEVICE_CTRL_HOT_JOIN_CTRL 0x00000100UL
#define I3C_MASTER_DEVICE_CTRL_DMA_ENABLE 0x10000000UL
#define I3C_MASTER_DEVICE_CTRL_ABORT 0x20000000UL
#define I3C_MASTER_DEVICE_CTRL_RESUME 0x40000000UL
#define I3C_MASTER_DEVICE_CTRL_ENABLE 0x80000000UL

#define I3C_MASTER_COMMAND_QUEUE_PORT_COMMAND_TRANSFER_COMMAND 0x00000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_COMMAND_TRANSFER_ARGUMENT 0x00000001UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_COMMAND_SHORT_DATA_ARGUMNENT 0x00000002UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_COMMAND_ADDRESS_ASSIGNMENT 0x00000003UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_COMMAND_MASK 0x00000007UL

#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_TID(tid) (((tid)<<3)&0x00000078UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_CMD(cmd) (((cmd)<<7)&0x00007F80UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_CP 0x00008000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_DEV_INDX(indx) (((indx)<<16)&0x001F0000UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_SPEED(speed) (((speed)<<21)&0x00E00000UL) 
 // #define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_RESV 0x01000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_DBP 0x02000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_ROC 0x04000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_SDAP 0x08000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_RnW 0x10000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_Write 0x00000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_Read I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_RnW
// #define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_RESV 0x20000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_TOC 0x40000000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_STOP I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_TOC
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_COMMAND_PEC 0x80000000UL
// #define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_ARGUMENT_RESV(resv) (((resv)<<3)&0x000000F8UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_ARGUMENT_DB(db) (((db)<<8)&0x0000FF00UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_TRANSFER_ARGUMENT_DATA_LENGTH(len) (((len)<<16)&0xFFFF0000UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_BYTE_STRB(strb) (((strb)<<3)&0x00000038UL) 
// #define I3C_MASTER_COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_RESV(resv) (((resv)<<6)&0x000000C0UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_DATA_BYTE_1_DB(byte1db) (((byte1db)<<8)&0x0000FF00UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_DATA_BYTE_2(byte) (((byte)<<16)&0x00FF0000UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_DATA_BYTE_3(byte) (((byte)<<24)&0xFF000000UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_TID(tid) (((tid)<<3)&0x00000078UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_CMD(cmd) (((cmd)<<7)&0x00007F80UL) 
// #define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_RESV 0x00008000UL
#define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_DEV_INDX(indx) (((indx)<<16)&0x001F0000UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_DEV_COUNT(count) (((count)<<21)&0x03E00000UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_ROC 0x04000000UL
// #define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_RESV(resv) (((resv)<<27)&0x380000F8UL) 
#define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_TOC 0x40000000UL
// #define I3C_MASTER_COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_RESV 0x80000000UL

#define I3C_MASTER_QUEUE_THLD_CTRL_CMD_EMPTY_BUF_THLD(thld) ((thld)&0x000000FFUL) 
#define I3C_MASTER_QUEUE_THLD_CTRL_RESP_BUF_THLD(thld) (((thld)<<8)&0x0000FF00UL) 
#define I3C_MASTER_QUEUE_THLD_CTRL_IBI_DATA_THLD(thld) (((thld)<<16)&0x00FF0000UL) 
#define I3C_MASTER_QUEUE_THLD_CTRL_IBI_STATUS_THLD(thld) (((thld)<<24)&0xFF000000UL) 

#define I3C_MASTER_DATA_BUFFER_THLD_CTRL_TX_EMPTY_BUF_THLD(thld) ((thld)&0x00000007UL)
#define I3C_MASTER_DATA_BUFFER_THLD_CTRL_RX_BUF_THLD(thld) (((thld)<<8)&0x00000700UL)
#define I3C_MASTER_DATA_BUFFER_THLD_CTRL_TX_START_THLD(thld) (((thld)<<16)&0x00070000UL)
#define I3C_MASTER_DATA_BUFFER_THLD_CTRL_RX_START_THLD(thld) (((thld)<<24)&0x07000000UL)

#define I3C_MASTER_INTR_STATUS_TX_THLD_STS 0x00000001UL
#define I3C_MASTER_INTR_STATUS_RX_THLD_STS 0x00000002UL
#define I3C_MASTER_INTR_STATUS_IBI_THLD_STS 0x00000004UL
#define I3C_MASTER_INTR_STATUS_CMD_QUEUE_READY_STS 0x00000008UL
#define I3C_MASTER_INTR_STATUS_RESP_READY_STS 0x00000010UL
#define I3C_MASTER_INTR_STATUS_TRANSFER_ABORT_STS 0x00000020UL
#define I3C_MASTER_INTR_STATUS_TRANSFER_ERR_STS 0x00000200UL
#define I3C_MASTER_INTR_STATUS_BUS_RESET_DONE_STS 0x00008000UL

#define I3C_MASTER_INTR_STATUS_EN_TX_THLD_STS_EN 0x00000001UL
#define I3C_MASTER_INTR_STATUS_EN_RX_THLD_STS_EN 0x00000002UL
#define I3C_MASTER_INTR_STATUS_EN_IBI_THLD_STS_EN 0x00000004UL
#define I3C_MASTER_INTR_STATUS_EN_CMD_QUEUE_READY_STS_EN 0x00000008UL
#define I3C_MASTER_INTR_STATUS_EN_RESP_READY_STS_EN 0x00000010UL
#define I3C_MASTER_INTR_STATUS_EN_TRANSFER_ABORT_STS_EN 0x00000020UL
#define I3C_MASTER_INTR_STATUS_EN_TRANSFER_ERR_STS_EN 0x00000200UL
#define I3C_MASTER_INTR_STATUS_EN_BUS_RESET_DONE_STS_EN 0x00008000UL

#define I3C_MASTER_SCL_I3C_OD_TIMING_HCNT(cnt) (((cnt)<<16)&0x00FF0000UL)
#define I3C_MASTER_SCL_I3C_OD_TIMING_LCNT(cnt) ((cnt)&0x000000FFUL)
#define I3C_MASTER_SCL_I3C_PP_TIMING_HCNT(cnt) (((cnt)<<16)&0x00FF0000UL)
#define I3C_MASTER_SCL_I3C_PP_TIMING_LCNT(cnt) ((cnt)&0x000000FFUL)
#define I3C_MASTER_SCL_I2C_FM_TIMING_HCNT(cnt) (((cnt)<<16)&0xFFFF0000UL)
#define I3C_MASTER_SCL_I2C_FM_TIMING_LCNT(cnt) ((cnt)&0x0000FFFFUL)
#define I3C_MASTER_SCL_I2C_FMP_TIMING_HCNT(cnt) (((cnt)<<16)&0xFFFF0000UL)
#define I3C_MASTER_SCL_I2C_FMP_TIMING_LCNT(cnt) ((cnt)&0x0000FFFFUL)

#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_STATIC_ADDRESS(addr) (((addr))&0x0000007FUL) 
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_IBI_PEC_EN 0x00000800UL
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_IBI_WITH_DATA 0x00001000UL
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_SIR_REJECT 0x00002000UL
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_MR_REJECT 0x00004000UL
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_DEV_DYNAMIC_ADDR(addr) (((addr)<<16)&0x00FF0000UL)
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_DEV_NACK_RETRY_CNT(cnt) (((cnt)<<29)& 0x60000000UL)
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_DEVICE  0x80000000UL
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_DEVICE_I2C  0x80000000UL
#define I3C_MASTER_DEV_ADDR_TABLE_LOC1_DEVICE_I3C  0x00000000UL

#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_NO_ERROR 0x00000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_CRC_ERROR 0x10000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_PARITY_ERROR 0x20000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_FRAME_ERROR 0x30000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_I3C_BROADCAST_ADDRESS_NACK_ERROR 0x40000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_ADDRESS_NACKED 0x50000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_RECELVE_BUFFER_OVERFLOWTRANSMIT_BUFFER_UNDERFLOW 0x60000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_TRANSFER_ABORTED 0x80000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_I2C_SLAVE_WRITE_DATA_NACK_ERROR 0x90000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_PEC_ERROR 0xC0000000UL
#define I3C_MASTER_RESPONSE_QUEUE_PORT_ERR_STS_MASK 0xF0000000UL

 /* * MASTER * */
//Controls whether or not i3c is enable
#define DISABLE_I3C HEX00
#define ENABLE_I3C HEX01
// DMA Handshake Interface Enable
#define DMA_DISABLE HEX00
#define DMA_ENABLE HEX01
//I2C_SLAVE_PRESENT
#define I2C_Slave_NO_PRESENT HEX00
#define I2C_Slave_PRESENT HEX01
//Legacy I2C device or not
#define I2C_No_device HEX00
#define I2C_device HEX01
#define TX_THLD_STAT_EN HEX01
#define RX_THLD_STAT_EN HEX02
#define IBI_THLD_STAT_EN HEX04
#define CMD_QUEUE_READY_STAT_EN HEX08
//Transmit Buffer Threshold Value
#define TX_EMPTY_BUF_THLD_1 0x000
#define TX_EMPTY_BUF_THLD_4 0x001
#define TX_EMPTY_BUF_THLD_8 0x010
#define TX_EMPTY_BUF_THLD_16 0x011
#define TX_EMPTY_BUF_THLD_32 0x100
#define TX_EMPTY_BUF_THLD_64 0x101
//Transmit Buffer Threshold Value
#define RX_BUF_THLD_1 0x000
#define RX_BUF_THLD_4 0x001
#define RX_BUF_THLD_8 0x010
#define RX_BUF_THLD_16 0x011
#define RX_BUF_THLD_32 0x100
#define RX_BUF_THLD_64 0x101

#define PP_TIMING_HCNT_MAX 0xff
#define PP_TIMING_LCNT_MAX 0xff
#define PP_TIMING_HCNT_MIN 0x5
#define PP_TIMING_LCNT_MIN 0x5

//I3C mode
#define SDR0_SPEED 0x0  //0~fSCL max
#define SDR1_SPEED 0x1  //8MHz
#define SDR2_SPEED 0x2  //6MHz
#define SDR3_SPEED 0x3  //4MHz
#define SDR4_SPEED 0x4  //2MHz

//I2C mode
#define FM_SPEED 0x0  //FM
#define FM_EX_SPEED 0x1  //FM+

//SDR SPEED
#define SDR_DEFAULT_SPEED 12500000

 /* * SLAVE * */
#define RXPEND_ENABLE 0x800     //第11位-接收FIFO满中断
#define TXSEND_ENABLE 0x1000     //第12位-发送FIFO空中断
//DMA Control register
#define DMAFB_RX_DISABLE HEX00
#define DMAFB_RX_ENABLE HEX01
#define DMATB_TX_DISABLE HEX00
#define DMATB_TX_ENABLE HEX01

#define I3C_TIMEOUT I2CTimeOut
#if I3C_DEBUG 
#define i3c_dprint assert_print
#else 
#define i3c_dprint(fmt, args...)
#endif

extern DWORD I3c_Channel_Baseaddr(BYTE i3c_mux);
extern void I3c_WriteREG_DWORD(DWORD value, WORD regoffset, BYTE i3c_mux);
extern DWORD I3c_ReadREG_DWORD(WORD regoffset, BYTE i3c_mux);
extern BYTE I3C_Master_Init(BYTE addr, uint32_t speed, BYTE i3c_mux);
extern uint32_t I3C_Master_ErrorStatus(BYTE i3c_mux);
extern uint32_t I3C_Master_IntStatus(BYTE i3c_mux);
extern BYTE I3c_Master_Write(uint8_t* data, uint16_t bytelen, BYTE i3c_mux);
extern uint8_t I3c_Master_Read(uint8_t* data, uint16_t bytelen, BYTE i3c_mux);
extern BYTE I3C_Master_W2R_Stream(BYTE i3c_addr, BYTE* w_var, WORD w_cnt, BYTE* r_var, WORD r_cnt, BYTE i3c_mux);
extern void I3c_Slave_Init(BYTE addr, BYTE i3c_mux);
extern BYTE I3C_SLAVE_INT_ENABLE(DWORD tpye, BYTE i3c_mux);
extern BYTE I3C_SLAVE_INT_DISABLE(DWORD tpye, BYTE i3c_mux);
// extern void I3C_LOOP_Test(void);

#endif