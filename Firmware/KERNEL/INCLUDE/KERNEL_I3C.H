/*
 * @Author: Iversu
 * @LastEditors: daweslinyu daowes.ly@qq.com
 * @LastEditTime: 2025-10-10 17:53:34
 * @Description:
 *
 *
 * The following is the Chinese and English copyright notice, encoded as UTF-8.
 * 以下是中文及英文版权同步声明，编码为UTF-8。
 * Copyright has legal effects and violations will be prosecuted.
 * 版权具有法律效力，违反必究。
 *
 * Copyright ©2021-2023 Sparkle Silicon Technology Corp., Ltd. All Rights Reserved.
 * 版权所有 ©2021-2023龙晶石半导体科技（苏州）有限公司
 */

#ifndef __KERNEL_I3C_H
#define __KERNEL_I3C_H
#include "AE_GLOBAL.H"
#include "AE_REG.H"
#include "AE_CONFIG.H"
#include "AE_DEBUGGER.H"

 /* * * * * MASTER * * * * */
 /** CCC Command Definitions of broadcast**/
#define ENEC_BC_CMD 0x00
#define DISEC_BC_CMD 0x01
#define ENTAS0_BC_CMD 0x02
#define ENTAS1_BC_CMD 0x03
#define ENTAS2_BC_CMD 0x04
#define ENTAS3_BC_CMD 0x05
#define RSTDAA_BC_CMD 0x06
#define ENTDAA_BC_CMD 0x07
#define DEFSLVS_BC_CMD 0x08
#define SETMWL_BC_CMD 0x09
#define SETMRL_BC_CMD 0x0A
#define ENTTM_BC_CMD 0x0B
#define ENTHDR0_BC_CMD 0x20
#define ENTHDR1_BC_CMD 0x21
#define ENTHDR2_BC_CMD 0x22
#define ENTHDR3_BC_CMD 0x23
#define ENTHDR4_BC_CMD 0x24
#define ENTHDR5_BC_CMD 0x25
#define ENTHDR6_BC_CMD 0x26
#define ENTHDR7_BC_CMD 0x27
#define SETXTIME_BC_CMD 0x28
/** CCC Command Definitions of direct**/
#define ENEC_DR_CMD 0x80
#define DISEC_DR_CMD 0x81
#define ENTAS0_DR_CMD 0x82
#define ENTAS1_DR_CMD 0x83
#define ENTAS2_DR_CMD 0x84
#define ENTAS3_DR_CMD 0x85
#define RSTDAA_DR_CMD 0x86
#define SETDASA_DR_CMD 0x87
#define SETNEWDA_DR_CMD 0x88
#define SETMWL_DR_CMD 0x89
#define SETMRL_DR_CMD 0x8A
#define GETMWL_DR_CMD 0x8B
#define GETMRL_DR_CMD 0x8C
#define GETPID_DR_CMD 0x8D
#define GETBCR_DR_CMD 0x8E
#define GETDCR_DR_CMD 0x8F
#define GETSTATUS_DR_CMD 0x90
#define GETACCMST_DR_CMD 0x91
#define SETBRGTGT_DR_CMD 0x93
#define GETMXDS_DR_CMD 0x94
#define GETHDRCAP_DR_CMD 0x95
#define SETXTIME_DR_CMD 0x98
#define GETXTIME_DR_CMD 0x99

#define BROADCAST_CMD_MAX 0x7F
#define DIRECTED_CMD_MIN 0x80

//i3c_mux select
#define I3C_MASTER0 0
#define I3C_MASTER1 1
#define I3C_SLAVE0 2
#define I3C_SLAVE1 3

//i3c master interface mode
#define I3C_MASTER_NO_MODE 0
#define I3C_MASTER_I3C_MODE 1
#define I3C_MASTER_I2C_MODE 2

//bits definition of register
#define DEVICE_CTRL_IBA_INCLUDE 0x00000001UL
#define DEVICE_CTRL_I2C_SLAVE_PRESENT 0x00000080UL
#define DEVICE_CTRL_HOT_JOIN_CTRL 0x00000100UL
#define DEVICE_CTRL_DMA_ENABLE 0x10000000UL
#define DEVICE_CTRL_ABORT 0x20000000UL
#define DEVICE_CTRL_RESUME 0x40000000UL
#define DEVICE_CTRL_ENABLE 0x80000000UL

#define DEVICE_ADDR_DYNAMIC_ADDR(addr) (((addr)<<16)&0x007F0000UL) 
#define DEVICE_ADDR_DYNAMIC_ADDR_VALID 0x80000000UL

#define IBI_QUEUE_STATUS_IBI_STATUS 0x80000000UL
#define IBI_QUEUE_STATUS_IBI_ID 0x0000FF00UL
#define IBI_QUEUE_STATUS_DATA_LENGTH 0x000000FFUL

#define QUEUE_STATUS_LEVEL_IBI_STS_CNT 0x1F000000UL
#define QUEUE_STATUS_LEVEL_IBI_BUF_BLR 0x00FF0000UL
#define QUEUE_STATUS_LEVEL_RESP_BUF_BLR 0x0000FF00UL
#define QUEUE_STATUS_LEVEL_CMD_QUEUE_EMPTY_LOC 0x000000FFUL

#define COMMAND_QUEUE_PORT_COMMAND_TRANSFER_COMMAND (~0x00000003UL)
#define COMMAND_QUEUE_PORT_COMMAND_TRANSFER_ARGUMENT 0x00000001UL
#define COMMAND_QUEUE_PORT_COMMAND_SHORT_DATA_ARGUMNENT 0x00000002UL
#define COMMAND_QUEUE_PORT_COMMAND_ADDRESS_ASSIGNMENT 0x00000003UL
#define COMMAND_QUEUE_PORT_COMMAND_MASK 0x00000007UL

#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_TID(tid) (((tid)<<3)&0x00000078UL) 
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_BC_TRANSFER (~0x00004000UL)
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_DR_TRANSFER (0x00004000UL)
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_CMD(cmd) (((cmd)<<7)&0x00007F80UL)
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_CP0 (~0x00008000UL)
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_CP 0x00008000UL
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_DEV_INDX0 (~0x001F0000UL) 
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_DEV_INDX(indx) (((indx)<<16)&0x001F0000UL)
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_SPEED_SDR0 (~0x00E00000UL) 
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_SPEED(speed) (((speed)<<21)&0x00E00000UL) 
 // #define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_RESV 0x01000000UL
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_DBP 0x02000000UL
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_ROC 0x04000000UL
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_SDAP 0x08000000UL
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_RnW(rw) (((rw)<<28)&0x10000000UL) 
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_WRITE (~0x10000000UL)
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_READ 0x10000000UL
// #define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_RESV 0x20000000UL
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_TOC 0x40000000UL
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_STOP COMMAND_QUEUE_PORT_TRANSFER_COMMAND_TOC
#define COMMAND_QUEUE_PORT_TRANSFER_COMMAND_PEC 0x80000000UL
// #define COMMAND_QUEUE_PORT_TRANSFER_ARGUMENT_RESV(resv) (((resv)<<3)&0x000000F8UL) 
#define COMMAND_QUEUE_PORT_TRANSFER_ARGUMENT_DB(db) (((db)<<8)&0x0000FF00UL) 
#define COMMAND_QUEUE_PORT_TRANSFER_ARGUMENT_DATA_LENGTH(len) (((len)<<16)&0xFFFF0000UL) 
#define COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_BYTE_STRB(strb) (((strb)<<3)&0x00000038UL) 
// #define COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_RESV(resv) (((resv)<<6)&0x000000C0UL) 
#define COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_RESV(byte1db) (((byte1db)<<8)&0x0000FF00UL) 
#define COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_DATA_BYTE_2(byte) (((byte)<<16)&0x00FF0000UL) 
#define COMMAND_QUEUE_PORT_SHORT_DATA_ARGUMNENT_DATA_BYTE_3(byte) (((byte)<<24)&0xFF000000UL) 
#define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_TID(tid) (((tid)<<3)&0x00000078UL) 
#define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_CMD(cmd) (((cmd)<<7)&0x00007F80UL) 
// #define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_RESV 0x00008000UL
#define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_DEV_INDX0 (~0x001F0000UL)
#define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_DEV_INDX(indx) (((indx)<<16)&0x001F0000UL) 
#define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_DEV_COUNT(count) (((count)<<21)&0x03E00000UL) 
#define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_ROC 0x04000000UL
// #define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_RESV(resv) (((resv)<<27)&0x380000F8UL) 
#define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_TOC 0x40000000UL
// #define COMMAND_QUEUE_PORT_ADDRESS_ASSIGNMENT_RESV 0x80000000UL

#define RESET_CTRL_BUS_RESET 0x80000000UL
#define RESET_CTRL_IBI_QUEUE_RST 0x00000020UL
#define RESET_CTRL_RX_FIFO_RST 0x00000010UL
#define RESET_CTRL_TX_FIFO_RST 0x00000008UL
#define RESET_CTRL_RESP_QUEUE_RST 0x00000004UL
#define RESET_CTRL_CMD_QUEUE_RST 0x00000002UL
#define RESET_CTRL_SOFT_RST 0x00000001UL

#define QUEUE_THLD_CTRL_CMD_EMPTY_BUF_THLD0 (~0x000000FFUL)
#define QUEUE_THLD_CTRL_CMD_EMPTY_BUF_THLD(thld) ((thld)&0x000000FFUL)
#define QUEUE_THLD_CTRL_RESP_BUF_THLD0 (~0x0000FF00UL)  
#define QUEUE_THLD_CTRL_RESP_BUF_THLD(thld) (((thld)<<8)&0x0000FF00UL) 
#define QUEUE_THLD_CTRL_IBI_DATA_THLD(thld) (((thld)<<16)&0x00FF0000UL)
#define QUEUE_THLD_CTRL_IBI_STATUS_THLD0 (~0xFF000000UL)  
#define QUEUE_THLD_CTRL_IBI_STATUS_THLD(thld) (((thld)<<24)&0xFF000000UL) 

#define DATA_BUFFER_THLD_CTRL_TX_EMPTY_BUF_THLD0 (~0x00000007UL)
#define DATA_BUFFER_THLD_CTRL_TX_EMPTY_BUF_THLD(thld) ((thld)&0x00000007UL)
#define DATA_BUFFER_THLD_CTRL_RX_BUF_THLD0 (~0x00000700UL)
#define DATA_BUFFER_THLD_CTRL_RX_BUF_THLD(thld) (((thld)<<8)&0x00000700UL)
#define DATA_BUFFER_THLD_CTRL_TX_START_THLD(thld) (((thld)<<16)&0x00070000UL)
#define DATA_BUFFER_THLD_CTRL_RX_START_THLD0 (~0x07000000UL)
#define DATA_BUFFER_THLD_CTRL_RX_START_THLD(thld) (((thld)<<24)&0x07000000UL)

#define INTR_STATUS_TX_THLD_STS 0x00000001UL
#define INTR_STATUS_RX_THLD_STS 0x00000002UL
#define INTR_STATUS_IBI_THLD_STS 0x00000004UL
#define INTR_STATUS_CMD_QUEUE_READY_STS 0x00000008UL
#define INTR_STATUS_RESP_READY_STS 0x00000010UL
#define INTR_STATUS_TRANSFER_ABORT_STS 0x00000020UL
#define INTR_STATUS_TRANSFER_ERR_STS 0x00000200UL
#define INTR_STATUS_BUS_RESET_DONE_STS 0x00008000UL

#define INTR_STATUS_EN_TX_THLD_STS_EN 0x00000001UL
#define INTR_STATUS_EN_RX_THLD_STS_EN 0x00000002UL
#define INTR_STATUS_EN_IBI_THLD_STS_EN 0x00000004UL
#define INTR_STATUS_EN_CMD_QUEUE_READY_STS_EN 0x00000008UL
#define INTR_STATUS_EN_RESP_READY_STS_EN 0x00000010UL
#define INTR_STATUS_EN_TRANSFER_ABORT_STS_EN 0x00000020UL
#define INTR_STATUS_EN_TRANSFER_ERR_STS_EN 0x00000200UL
#define INTR_STATUS_EN_BUS_RESET_DONE_STS_EN 0x00008000UL

#define INTR_SIGNAL_EN_TX_THLD_SIGNAL_EN 0x00000001UL
#define INTR_SIGNAL_EN_RX_THLD_SIGNAL_EN 0x00000002UL
#define INTR_SIGNAL_EN_IBI_THLD_SIGNAL_EN 0x00000004UL
#define INTR_SIGNAL_EN_CMD_QUEUE_READY_SIGNAL_EN 0x00000008UL
#define INTR_SIGNAL_EN_RESP_READY_SIGNAL_EN 0x00000010UL
#define INTR_SIGNAL_EN_TRANSFER_ABORT_SIGNAL_EN 0x00000020UL
#define INTR_SIGNAL_EN_TRANSFER_ERR_SIGNAL_EN 0x00000200UL
#define INTR_SIGNAL_EN_BUS_RESET_DONE_SIGNAL_EN 0x00008000UL

#define SCL_I3C_OD_TIMING_HCNT(cnt) (((cnt)<<16)&0x00FF0000UL)
#define SCL_I3C_OD_TIMING_LCNT(cnt) ((cnt)&0x000000FFUL)
#define SCL_I3C_PP_TIMING_HCNT(cnt) (((cnt)<<16)&0x00FF0000UL)
#define SCL_I3C_PP_TIMING_LCNT(cnt) ((cnt)&0x000000FFUL)
#define SCL_I2C_FM_TIMING_HCNT(cnt) (((cnt)<<16)&0xFFFF0000UL)
#define SCL_I2C_FM_TIMING_LCNT(cnt) ((cnt)&0x0000FFFFUL)
#define SCL_I2C_FMP_TIMING_HCNT(cnt) (((cnt)<<16)&0xFFFF0000UL)
#define SCL_I2C_FMP_TIMING_LCNT(cnt) ((cnt)&0x0000FFFFUL)

#define DEV_ADDR_TABLE_LOC1_STATIC_ADDRESS(addr) (((addr))&0x0000007FUL) 
#define DEV_ADDR_TABLE_LOC1_IBI_PEC_EN 0x00000800UL
#define DEV_ADDR_TABLE_LOC1_IBI_WITH_DATA 0x00001000UL
#define DEV_ADDR_TABLE_LOC1_SIR_REJECT 0x00002000UL
#define DEV_ADDR_TABLE_LOC1_MR_REJECT 0x00004000UL
#define DEV_ADDR_TABLE_LOC1_DEV_DYNAMIC_ADDR_PARITY0 (~0x00800000UL)
#define DEV_ADDR_TABLE_LOC1_DEV_DYNAMIC_ADDR_PARITY1 0x00800000UL
#define DEV_ADDR_TABLE_LOC1_DEV_DYNAMIC_ADDR_PARITY(data) ((ODD_PARITY_7BIT(data)<<23)&0x00800000UL)
#define DEV_ADDR_TABLE_LOC1_DEV_DYNAMIC_ADDR(addr) (((addr)<<16)&0x007F0000UL)
#define DEV_ADDR_TABLE_LOC1_DEV_NACK_RETRY_CNT(cnt) (((cnt)<<29)& 0x60000000UL)
#define DEV_ADDR_TABLE_LOC1_DEVICE  0x80000000UL
#define DEV_ADDR_TABLE_LOC1_DEVICE_I2C  0x80000000UL
#define DEV_ADDR_TABLE_LOC1_DEVICE_I3C  (~0x80000000UL)

#define RESPONSE_QUEUE_PORT_ERR_STS_NO_ERROR 0x00000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_CRC_ERROR 0x10000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_PARITY_ERROR 0x20000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_FRAME_ERROR 0x30000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_I3C_BROADCAST_ADDRESS_NACK_ERROR 0x40000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_ADDRESS_NACKED 0x50000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_RECELVE_BUFFER_OVERFLOWTRANSMIT_BUFFER_UNDERFLOW 0x60000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_TRANSFER_ABORTED 0x80000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_I2C_SLAVE_WRITE_DATA_NACK_ERROR 0x90000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_PEC_ERROR 0xC0000000UL
#define RESPONSE_QUEUE_PORT_ERR_STS_MASK 0xF0000000UL

 /* * MASTER * */
//Controls whether or not i3c is enable
#define DISABLE_I3C HEX00
#define ENABLE_I3C HEX01
// DMA Handshake Interface Enable
#define DMA_DISABLE HEX00
#define DMA_ENABLE HEX01
//I2C_SLAVE_PRESENT
#define I2C_Slave_NO_PRESENT HEX00
#define I2C_Slave_PRESENT HEX01
//Legacy I2C device or not
#define I2C_No_device HEX00
#define I2C_device HEX01
#define TX_THLD_STAT_EN HEX01
#define RX_THLD_STAT_EN HEX02
#define IBI_THLD_STAT_EN HEX04
#define CMD_QUEUE_READY_STAT_EN HEX08
//RESP_BUF_THLD
#define RESP_BUF_THLD_1 0b000
//CMD_EMPTY_BUF_THLD
#define CMD_EMPTY_BUF_THLD_ALLEMPTY 0b000
#define CMD_EMPTY_BUF_THLD_1 0b001
#define CMD_EMPTY_BUF_THLD_2 0b010
#define CMD_EMPTY_BUF_THLD_3 0b011
//RX START THLD
#define RX_START_THLD_1 0b000
#define RX_START_THLD_4 0b001
#define RX_START_THLD_8 0b010
#define RX_START_THLD_16 0b011
#define RX_START_THLD_32 0b100
#define RX_START_THLD_64 0b101
//TX START THLD
#define TX_START_THLD_1 0b000
#define TX_START_THLD_4 0b001
#define TX_START_THLD_8 0b010
#define TX_START_THLD_16 0b011
#define TX_START_THLD_32 0b100
#define TX_START_THLD_64 0b101
//Transmit Buffer Threshold Value
#define TX_EMPTY_BUF_THLD_1 0b000
#define TX_EMPTY_BUF_THLD_4 0b001
#define TX_EMPTY_BUF_THLD_8 0b010
#define TX_EMPTY_BUF_THLD_16 0b011
#define TX_EMPTY_BUF_THLD_32 0b100
#define TX_EMPTY_BUF_THLD_64 0b101
//Transmit Buffer Threshold Value
#define RX_BUF_THLD_1 0b000
#define RX_BUF_THLD_4 0b001
#define RX_BUF_THLD_8 0b010
#define RX_BUF_THLD_16 0b011
#define RX_BUF_THLD_32 0b100
#define RX_BUF_THLD_64 0b101

#define PP_TIMING_HCNT_MAX 0xff
#define PP_TIMING_LCNT_MAX 0xff
#define PP_TIMING_HCNT_MIN 0x0e
#define PP_TIMING_LCNT_MIN 0x0e

//I3C mode
#define SDR0_SPEED 0x0  //0~fSCL max
#define SDR1_SPEED 0x1  //8MHz
#define SDR2_SPEED 0x2  //6MHz
#define SDR3_SPEED 0x3  //4MHz
#define SDR4_SPEED 0x4  //2MHz

//I2C mode
#define FM_SPEED 0x0  //FM
#define FM_EX_SPEED 0x1  //FM+

//SDR SPEED
#define SDR_DEFAULT_SPEED 9600000
//write/read
#define I3C_MASTER_WRITE 0
#define I3C_MASTER_READ 1

/* * * * * SLAVE * * * * */
#define SLAVE0_SET_STATICADDR 0x5A
#define SLAVE0_SET_IDPARTNO 0x12345678
#define SLAVE0_SET_DCR 0x9A
#define SLAVE0_SET_BCR 0xBC

#define SLAVE1_SET_STATICADDR 0x6A
#define SLAVE1_SET_IDPARTNO 0x87654321
#define SLAVE1_SET_DCR 0xAA
#define SLAVE1_SET_BCR 0xCC

#define RXPEND_ENABLE 0x800     //第11位-接收FIFO满中断
#define TXSEND_ENABLE 0x1000     //第12位-发送FIFO空中断

#define WDATAB_LASTBYTE 0x00010100UL
#define START_IBI 0x00000001UL
#define START_MAIN_PTP_REQUEST 0x00000002UL
#define HOTJOIN_REQUEST 0x00000003UL
#define IBI_DATA(data) (((data)<<8) & 0x0000FF00UL)

#define CONFIG_ADDR(addr) (((addr)<<25) & 0xFE000000UL) //7bit static addr
#define CONFIG_SLVENA 0x00000001UL

#define IDEXT_DCR(dcr) (((dcr)<<8) & 0x0000FF00UL)
#define IDEXT_BCR(bcr) (((bcr)<<16)& 0x00FF0000UL)

//DMA Control register
#define DMAFB_RX_DISABLE HEX00
#define DMAFB_RX_ENABLE HEX01
#define DMATB_TX_DISABLE HEX00
#define DMATB_TX_ENABLE HEX01

#define I3C_TIMEOUT I2CTimeOut
#if I3C_DEBUG 
#define i3c_dprint dprint
#else 
#define i3c_dprint(fmt, args...)
#endif

// 对7bit位宽的数据进行奇校验，返回校验位（0或1）
// 参数：data - 需校验的7bit数据（注意：仅低7位有效，高1位会被忽略）
#define ODD_PARITY_7BIT(data) ({ \
    unsigned char _7bit_data = (data) & 0x7F;  /* 只保留低7位，确保是7bit数据 */ \
    unsigned char _count = 0;                  /* 统计1的个数 */ \
    _count += (_7bit_data >> 0) & 1;           /* 第0位 */ \
    _count += (_7bit_data >> 1) & 1;           /* 第1位 */ \
    _count += (_7bit_data >> 2) & 1;           /* 第2位 */ \
    _count += (_7bit_data >> 3) & 1;           /* 第3位 */ \
    _count += (_7bit_data >> 4) & 1;           /* 第4位 */ \
    _count += (_7bit_data >> 5) & 1;           /* 第5位 */ \
    _count += (_7bit_data >> 6) & 1;           /* 第6位（7bit的最高位） */ \
    (_count % 2 == 0) ? 1 : 0;                 /* 若1的个数为偶数，校验位为1；否则为0（确保总数为奇数） */ \
})



//device char table structure define
typedef union DEV_CHAR_TABLE {
    u32 dev_char_table1_loc[4];
    struct {
        struct {
            uint32_t lsb_provisional_id : 32;
        } loc1;
        struct {
            uint32_t reserved_loc2;
            uint32_t lsb_provisional_id : 32;
        } loc2;
        struct {
            uint32_t reserved_loc3 : 16;
            uint32_t bcr : 8;
            uint32_t dcr : 8;
        } loc3;
        struct {
            uint32_t reserved_loc4 : 24;
            uint32_t dev_dynamic_addr : 8;
        } loc4;
    } dct_bits;
} sDEV_CHAR_TABLE;

//function extern
extern BYTE MASTER0_DEV_DYNAMIC_ADDR_TABLE[];
extern BYTE MASTER1_DEV_DYNAMIC_ADDR_TABLE[];
extern BYTE MASTER0_DEV_STATIC_ADDR_TABLE[];
extern BYTE MASTER1_DEV_STATIC_ADDR_TABLE[];
extern sDEV_CHAR_TABLE master0_dev_read_char_table[];
extern sDEV_CHAR_TABLE master1_dev_read_char_table[];

extern DWORD I3C_Channel_Baseaddr(BYTE i3c_mux);
extern void I3C_WriteREG_DWORD(DWORD value, WORD regoffset, BYTE i3c_mux);
extern DWORD I3C_ReadREG_DWORD(WORD regoffset, BYTE i3c_mux);
extern BYTE I3C_WAIT_SDA_PU(BYTE i3c_mux);
extern uint32_t I3C_Master_RespData_ERRSTS(BYTE i3c_mux);
extern uint32_t I3C_Master_IntrStatus(BYTE i3c_mux);
extern BYTE I3C_Legacy_Master_Init(BYTE addr, uint32_t speed, BYTE i3c_mux);
extern BYTE I3C_Legacy_Master_Write(uint8_t* data, uint16_t bytelen, BYTE i3c_mux);
extern uint8_t I3C_Legacy_Master_Read(uint8_t* data, uint16_t bytelen, BYTE i3c_mux);
extern BYTE I3C_Legacy_Master_W2R_Stream(BYTE i3c_addr, BYTE* w_var, WORD w_cnt, BYTE* r_var, WORD r_cnt, BYTE i3c_mux);
extern BYTE I3C_MASTER_ENTDAA(sDEV_CHAR_TABLE* dct, BYTE* dynamic_addr, BYTE i3c_mux);
extern BYTE I3C_MASTER_SETDASA(BYTE static_addr, BYTE dynamic_addr, BYTE i3c_mux);
extern BYTE I3C_MASTER_BC_CCC_WRITE(uint8_t* data, uint16_t bytelen, BYTE cmd, uint8_t dbp, uint8_t db, BYTE i3c_mux);
extern BYTE I3C_MASTER_DR_CCC_WRITE(uint8_t static_addr, uint8_t* data, uint16_t bytelen, BYTE cmd, uint8_t dbp, uint8_t db, BYTE i3c_mux);
extern BYTE I3C_MASTER_DR_CCC_READ(uint8_t static_addr, uint8_t* data, uint16_t bytelen, BYTE cmd, uint8_t dbp, uint8_t db, BYTE i3c_mux);
extern BYTE I3C_MASTER_PV_WRITE_WITH7E(uint8_t dynamic_addr, uint8_t* data, uint16_t bytelen, BYTE i3c_mux);
extern BYTE I3C_MASTER_PV_READ_WITH7E(uint8_t dynamic_addr, uint8_t* data, uint16_t bytelen, BYTE i3c_mux);
extern BYTE I3C_MASTER_PV_WRITE_THEN_READ_WITH7E(uint8_t dynamic_addr, uint8_t* wdata, uint16_t wbytelen, uint8_t* rdata, uint16_t rbytelen, BYTE i3c_mux);
extern void I3C_MASTER_IBI_Handler(BYTE i3c_mux);
extern void I3C_Master_Init(uint32_t initmode, uint32_t speed, BYTE addr, sDEV_CHAR_TABLE* dct, BYTE* dynamic_addr, uint8_t i3c_mux);
extern void I3C_Slave_Init(BYTE static_addr, uint32_t idpartno, uint8_t dcr, uint8_t bcr, uint8_t i3c_mux);
extern BYTE I3C_SLAVE_INT_ENABLE(DWORD tpye, BYTE i3c_mux);
extern BYTE I3C_SLAVE_INT_DISABLE(DWORD tpye, BYTE i3c_mux);
extern BYTE I3C_SLAVE_IBI_HOTJOIN(uint8_t addr, uint32_t idpartno, uint8_t dcr, uint8_t bcr, BYTE i3c_mux);
extern BYTE I3C_SLAVE_IBI_DATA(uint8_t addr, uint8_t ibi_data, uint32_t idpartno, uint8_t dcr, uint8_t bcr, BYTE i3c_mux);
// extern void I3C_LOOP_Test(void);

#endif